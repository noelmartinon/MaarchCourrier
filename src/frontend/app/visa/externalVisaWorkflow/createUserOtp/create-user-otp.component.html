<div class="mat-dialog-content-container">
    <h1 mat-dialog-title>{{(data === null ? 'lang.addOtp' : 'lang.updateOtp') | translate}}</h1>
    <div mat-dialog-content>
        <div *ngIf="loading" class="loading" style="display:flex;height:100%;">
            <mat-spinner style="margin:auto;"></mat-spinner>
        </div>
        <div *ngIf="!loading" class="userForm">
            <mat-form-field *ngIf="sources.length > 1" appearance="fill">
                <mat-label>{{ 'lang.source' | translate }}</mat-label>
                <mat-select #source [(ngModel)]="userOTP.sourceId" (selectionChange)="setCurrentSource($event.value)" required>
                    <mat-option *ngFor="let source of sources" [value]="source.id" >
                        {{ source.label }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>{{'lang.firstname' | translate}}</mat-label>
                <input matInput #firstname type="text" maxlength="128" [(ngModel)]="userOTP.firstname" required>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>{{'lang.lastname' | translate}}</mat-label>
                <input matInput #lastname type="text" maxlength="128" [(ngModel)]="userOTP.lastname"  required>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>{{'lang.phoneNumber' | translate}}</mat-label>
                <input matInput #phoneNumber type="text" [(ngModel)]="userOTP.phone" pattern="^((\+)33)[1-9](\d{2}){4}$" required>
                <mat-hint align="start">{{ 'lang.frFormatPhone' | translate }}</mat-hint>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>{{'lang.email' | translate}}</mat-label>
                <input matInput #email type="email" [(ngModel)]="userOTP.email" pattern="(^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$)" required>
            </mat-form-field>
            <mat-form-field *ngIf="currentSource.length > 1" appearance="fill">
                <mat-label>{{ 'lang.securityMode' | translate }}</mat-label>
                <mat-select #securityMode [(ngModel)]="userOTP.security"required>
                    <mat-option *ngFor="let mode of currentSource" [value]="mode" >
                        {{ 'lang.' + mode | translate }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-label>{{'lang.role' | translate}}</mat-label>
            <mat-form-field>
                <input matInput style="display: none;">
                <mat-radio-group #role style="display: inline-flex;flex-direction: row;" [(ngModel)]="userOTP.role" required>
                    <mat-radio-button *ngFor="let role of availableRoles" [value]="role.id" style="margin-right: 20px;" color="primary">
                        {{ role.label }}
                    </mat-radio-button>
                </mat-radio-group >
            </mat-form-field>
            <app-maarch-message *ngIf="userOTP.security" [mode]="'info'" [content]="'lang.securityModeInfo' | translate : {mode: userOTP.security}"></app-maarch-message>
        </div>
    </div>
    <span class="divider-modal"></span>
    <div mat-dialog-actions class="actions">
        <button mat-raised-button mat-button color="primary" [disabled]="loading || !isValidForm()" (click)="addOtpUser()">{{ (this.data === null ? 'lang.validate' : 'lang.update') | translate}}</button>
        <button mat-raised-button mat-button [mat-dialog-close]="">{{'lang.cancel' | translate}}</button>
    </div>
</div>
